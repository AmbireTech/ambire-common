{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../src/libs/humanizer/index.ts"],"names":[],"mappings":"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","sourcesContent":["import humanizerInfo from '../../consts/humanizer/humanizerInfo.json'\nimport { Storage } from '../../interfaces/storage'\nimport { Message } from '../../interfaces/userRequest'\nimport { AccountOp } from '../accountOp/accountOp'\nimport { parse, stringify } from '../richJson/richJson'\nimport {\n  HumanizerCallModule,\n  HumanizerMeta,\n  HumanizerOptions,\n  IrCall,\n  IrMessage\n} from './interfaces'\nimport {\n  ensMessageModule,\n  entryPointModule,\n  erc20Module,\n  erc721Module,\n  legendsMessageModule,\n  openseaMessageModule,\n  permit2Module\n} from './messageModules'\nimport OneInchModule from './modules/1Inch'\nimport { aaveHumanizer } from './modules/Aave'\nimport AcrossModule from './modules/Across'\nimport { airdropsModule } from './modules/Airdrops'\nimport asciiModule from './modules/AsciiModule'\nimport curveModule from './modules/Curve'\nimport { deploymentModule } from './modules/Deployment'\nimport { embeddedAmbireOperationHumanizer } from './modules/embeddedAmbireOperationHumanizer'\nimport { ensModule } from './modules/ENS'\nimport fallbackHumanizer from './modules/FallbackHumanizer'\nimport gasTankModule from './modules/GasTankModule'\nimport KyberSwap from './modules/KyberSwap'\nimport legendsModule from './modules/Legends'\nimport { LidoModule } from './modules/Lido'\nimport { openSeaModule } from './modules/OpenSea'\nimport { postProcessing } from './modules/PostProcessing/postProcessModule'\nimport preProcessHumanizer from './modules/PreProcess'\nimport privilegeHumanizer from './modules/Privileges'\nimport singletonFactory from './modules/SingletonFactory'\nimport { SocketModule } from './modules/Socket'\nimport sushiSwapModule from './modules/Sushiswap'\nimport { genericErc20Humanizer, genericErc721Humanizer } from './modules/Tokens'\nimport traderJoeModule from './modules/TraderJoe'\nimport { uniswapHumanizer } from './modules/Uniswap'\nimport { WALLETModule } from './modules/WALLET'\nimport wrappingModule from './modules/Wrapping'\n\n// from most generic to least generic\n// the final humanization is the final triggered module\nexport const humanizerCallModules: HumanizerCallModule[] = [\n  preProcessHumanizer,\n  embeddedAmbireOperationHumanizer,\n  deploymentModule,\n  genericErc721Humanizer,\n  genericErc20Humanizer,\n  LidoModule,\n  gasTankModule,\n  airdropsModule,\n  uniswapHumanizer,\n  curveModule,\n  traderJoeModule,\n  KyberSwap,\n  SocketModule,\n  AcrossModule,\n  OneInchModule,\n  wrappingModule,\n  aaveHumanizer,\n  WALLETModule,\n  privilegeHumanizer,\n  sushiSwapModule,\n  legendsModule,\n  singletonFactory,\n  ensModule,\n  openSeaModule,\n  asciiModule,\n  fallbackHumanizer,\n  postProcessing\n]\n\n// from least generic to most generic\n// the final visualization and warnings are from the first triggered module\nconst humanizerTMModules = [\n  erc20Module,\n  erc721Module,\n  permit2Module,\n  entryPointModule,\n  legendsMessageModule,\n  ensMessageModule,\n  openseaMessageModule\n]\n\nconst humanizeAccountOp = (_accountOp: AccountOp, options: HumanizerOptions): IrCall[] => {\n  const accountOp = parse(stringify(_accountOp))\n  const humanizerOptions: HumanizerOptions = {\n    ...options,\n    networkId: accountOp.networkId\n  }\n\n  let currentCalls: IrCall[] = accountOp.calls\n  humanizerCallModules.forEach((hm) => {\n    try {\n      currentCalls = hm(accountOp, currentCalls, humanizerInfo as HumanizerMeta, humanizerOptions)\n    } catch (error) {\n      console.error(error)\n      // No action is needed here; we only set `currentCalls` if the module successfully resolves the calls.\n    }\n  })\n  return currentCalls\n}\n\nconst humanizeMessage = (_message: Message): IrMessage => {\n  const message = parse(stringify(_message))\n\n  try {\n    // runs all modules and takes the first non empty array\n    const { fullVisualization, warnings } =\n      humanizerTMModules.map((m) => m(message)).filter((p) => p.fullVisualization?.length)[0] || {}\n\n    return { ...message, fullVisualization, warnings }\n  } catch (error) {\n    console.error(error)\n    return message\n  }\n}\n\n// As of version v4.34.0 HumanizerMetaV2 in storage is no longer needed. It was\n// used for persisting learnt data from async operations, triggered by the\n// humanization process.\nasync function clearHumanizerMetaObjectFromStorage(storage: Storage) {\n  await storage.remove('HumanizerMetaV2')\n}\n\nexport { humanizeAccountOp, humanizeMessage, clearHumanizerMetaObjectFromStorage }\n"]}