{"version":3,"file":"permit2Module.js","sourceRoot":"","sources":["../../../../../src/libs/humanizer/messageModules/permit2Module.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,gBAAgB,EAAE,MAAM,2BAA2B,CAAA;AAG5D,OAAO,EAAE,SAAS,EAAE,uBAAuB,EAAE,WAAW,EAAE,QAAQ,EAAE,QAAQ,EAAE,MAAM,UAAU,CAAA;AAoC9F,MAAM,eAAe,GAAG,CAAC,MAAqB,EAA4B,EAAE;IAC1E,OAAO;QACL,SAAS,CAAC,QAAQ,CAAC;QACnB,uBAAuB,CAAC,gBAAgB,CAAC;QACzC,QAAQ,CAAC,QAAQ,CAAC;QAClB,QAAQ,CAAC,MAAM,CAAC,KAAK,EAAE,MAAM,CAAC,MAAM,CAAC;QACrC,QAAQ,CAAC,iBAAiB,CAAC;QAC3B,WAAW,CAAC,MAAM,CAAC,UAAU,CAAC;KAC/B,CAAA;AACH,CAAC,CAAA;AAED,MAAM,CAAC,MAAM,aAAa,GAAgC,CAAC,OAAgB,EAAE,EAAE;IAC7E,IAAI,OAAO,CAAC,OAAO,CAAC,IAAI,KAAK,cAAc;QAAE,OAAO,EAAE,iBAAiB,EAAE,EAAE,EAAE,CAAA;IAC7E,MAAM,EAAE,GAAG,OAAO,CAAC,OAAO,CAAA;IAC1B,MAAM,cAAc,GAA6B,EAAE,CAAA;IACnD,IACE,EAAE,EAAE,MAAM,EAAE,iBAAiB;QAC7B,EAAE,CAAC,MAAM,CAAC,iBAAiB,CAAC,WAAW,EAAE,KAAK,gBAAgB,CAAC,WAAW,EAAE,EAC5E;QACA,IAAI,EAAE,EAAE,KAAK,EAAE,YAAY,EAAE,CAAC,CAAC,CAAC,EAAE,IAAI,KAAK,eAAe,EAAE;YAC1D,cAAc,CAAC,IAAI,CACjB,GAAG,eAAe,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,EACtC,QAAQ,CAAC,uBAAuB,CAAC,EACjC,WAAW,CAAC,EAAE,CAAC,OAAO,CAAC,WAAW,CAAC,CACpC,CAAA;SACF;aAAM,IAAI,EAAE,EAAE,KAAK,EAAE,WAAW,EAAE,CAAC,CAAC,CAAC,EAAE,IAAI,KAAK,iBAAiB,EAAE;YAClE,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,aAA4B,EAAE,CAAS,EAAE,EAAE;gBACrE,cAAc,CAAC,IAAI,CACjB,GAAG;oBACD,QAAQ,CAAC,WAAW,CAAC,GAAG,CAAC,EAAE,CAAC;oBAC5B,GAAG,eAAe,CAAC,aAAa,CAAC;oBACjC,QAAQ,CAAC,uBAAuB,CAAC;oBACjC,WAAW,CAAC,EAAE,CAAC,OAAO,CAAC,WAAW,CAA2B;iBAC9D,CACF,CAAA;YACH,CAAC,CAAC,CAAA;SACH;QACD,OAAO,EAAE,iBAAiB,EAAE,cAAc,EAAE,CAAA;KAC7C;IAED,OAAO,EAAE,iBAAiB,EAAE,EAAE,EAAE,CAAA;AAClC,CAAC,CAAA","sourcesContent":["import { PERMIT_2_ADDRESS } from '../../../consts/addresses'\nimport { Message } from '../../../interfaces/userRequest'\nimport { HumanizerTypedMessageModule, HumanizerVisualization } from '../interfaces'\nimport { getAction, getAddressVisualization, getDeadline, getLabel, getToken } from '../utils'\n\n// interfaces\n// export interface PermitSingle {\n//     details: PermitDetails\n//     spender: string\n//     sigDeadline: BigNumberish\n//   }\n\n// interface PermitBatch {\n//   details: PermitDetails[]\n//   spender: string\n//   sigDeadline: BigNumberish\n// }\n\n// example\n// const permitSingle: PermitSingle = {\n//   details: {\n//     token: tokenAddress,\n//     amount: MaxAllowanceTransferAmount,\n//     // You may set your own deadline - we use 30 days.\n//     expiration: toDeadline(/* 30 days= */ 1000 * 60 * 60 * 24 * 30),\n//     nonce\n//   },\n//   spender: spenderAddress,\n//   // You may set your own deadline - we use 30 minutes.\n//   sigDeadline: toDeadline(/* 30 minutes= */ 1000 * 60 * 60 * 30)\n// }\n\ninterface PermitDetails {\n  token: string\n  amount: bigint\n  expiration: bigint\n  nonce: bigint\n}\n\nconst visualizePermit = (permit: PermitDetails): HumanizerVisualization[] => {\n  return [\n    getAction('Permit'),\n    getAddressVisualization(PERMIT_2_ADDRESS),\n    getLabel('to use'),\n    getToken(permit.token, permit.amount),\n    getLabel('for time period'),\n    getDeadline(permit.expiration)\n  ]\n}\n\nexport const permit2Module: HumanizerTypedMessageModule = (message: Message) => {\n  if (message.content.kind !== 'typedMessage') return { fullVisualization: [] }\n  const tm = message.content\n  const visualizations: HumanizerVisualization[] = []\n  if (\n    tm?.domain?.verifyingContract &&\n    tm.domain.verifyingContract.toLowerCase() === PERMIT_2_ADDRESS.toLowerCase()\n  ) {\n    if (tm?.types?.PermitSingle?.[0]?.type === 'PermitDetails') {\n      visualizations.push(\n        ...visualizePermit(tm.message.details),\n        getLabel('this whole signatuere'),\n        getDeadline(tm.message.sigDeadline)\n      )\n    } else if (tm?.types?.PermitBatch?.[0]?.type === 'PermitDetails[]') {\n      tm.message.details.forEach((permitDetails: PermitDetails, i: number) => {\n        visualizations.push(\n          ...[\n            getLabel(`Permit #${i + 1}`),\n            ...visualizePermit(permitDetails),\n            getLabel('this whole signatuere'),\n            getDeadline(tm.message.sigDeadline) as HumanizerVisualization\n          ]\n        )\n      })\n    }\n    return { fullVisualization: visualizations }\n  }\n\n  return { fullVisualization: [] }\n}\n"]}