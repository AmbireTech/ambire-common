{"version":3,"file":"erc7677.js","sourceRoot":"","sources":["../../../../src/libs/erc7677/erc7677.ts"],"names":[],"mappings":";;;AAAA,mCAA4C;AAE5C,gDAAyD;AAEzD,sDAAwD;AAExD,kEAA+D;AAQ/D,SAAgB,mBAAmB,CACjC,OAAe,EACf,YAA2D;IAE3D,IAAI,CAAC,YAAY,IAAI,CAAC,YAAY,CAAC,gBAAgB;QAAE,OAAO,SAAS,CAAA;IAErE,4DAA4D;IAC5D,MAAM,UAAU,GAAG,IAAA,gBAAO,EAAC,OAAO,CAAkB,CAAA;IACpD,MAAM,eAAe,GAAG,IAAA,mBAAU,EAAC,OAAO,CAAkB,CAAA;IAC5D,MAAM,gBAAgB,GACpB,UAAU,IAAI,YAAY,CAAC,gBAAgB;QACzC,CAAC,CAAC,YAAY,CAAC,gBAAgB,CAAC,UAAU,CAAC;QAC3C,CAAC,CAAC,YAAY,CAAC,gBAAgB,CAAC,eAAe,CAAC,CAAA;IACpD,IAAI,CAAC,gBAAgB;QAAE,OAAO,SAAS,CAAA;IAEvC,gBAAgB,CAAC,EAAE,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAA;IAC1C,OAAO,gBAAgB,CAAA;AACzB,CAAC;AAjBD,kDAiBC;AAED,SAAgB,oBAAoB,CAClC,OAAyB,EACzB,MAAqB,EACrB,OAAgB;IAEhB,MAAM,QAAQ,GAAG,IAAA,yBAAc,EAAC,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE,OAAO,CAAC,OAAO,CAAC,CAAA;IAC/D,OAAO,QAAQ,CAAC,IAAI,CAAC,yBAAyB,EAAE;QAC9C,IAAA,8BAAc,EAAC,MAAM,CAAC,CAAC,CAAC,CAAC;QACzB,4BAAmB;QACnB,IAAA,gBAAO,EAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;QACnC,OAAO,CAAC,OAAO;KAChB,CAAC,CAAA;AACJ,CAAC;AAZD,oDAYC;AAEM,KAAK,UAAU,gBAAgB,CACpC,OAAyB,EACzB,MAAqB,EACrB,OAAgB;IAEhB,MAAM,QAAQ,GAAG,IAAA,yBAAc,EAAC,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE,OAAO,CAAC,OAAO,CAAC,CAAA;IAC/D,OAAO,QAAQ,CAAC,IAAI,CAAC,qBAAqB,EAAE;QAC1C,IAAA,8BAAc,EAAC,MAAM,CAAC,CAAC,CAAC,CAAC;QACzB,4BAAmB;QACnB,IAAA,gBAAO,EAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;QACnC,OAAO,CAAC,OAAO;KAChB,CAAC,CAAA;AACJ,CAAC;AAZD,4CAYC","sourcesContent":["import { toBeHex, toQuantity } from 'ethers'\n\nimport { ERC_4337_ENTRYPOINT } from '../../consts/deploy'\nimport { Network } from '../../interfaces/network'\nimport { getRpcProvider } from '../../services/provider'\nimport { UserOperation } from '../userOperation/types'\nimport { getCleanUserOp } from '../userOperation/userOperation'\nimport {\n  PaymasterCapabilities,\n  PaymasterData,\n  PaymasterEstimationData,\n  PaymasterService\n} from './types'\n\nexport function getPaymasterService(\n  chainId: bigint,\n  capabilities?: { paymasterService?: PaymasterCapabilities }\n): PaymasterService | undefined {\n  if (!capabilities || !capabilities.paymasterService) return undefined\n\n  // hex may come with a leading zero or not. Prepare for both\n  const chainIdHex = toBeHex(chainId) as `0x${string}`\n  const chainIdQuantity = toQuantity(chainId) as `0x${string}`\n  const paymasterService =\n    chainIdHex in capabilities.paymasterService\n      ? capabilities.paymasterService[chainIdHex]\n      : capabilities.paymasterService[chainIdQuantity]\n  if (!paymasterService) return undefined\n\n  paymasterService.id = new Date().getTime()\n  return paymasterService\n}\n\nexport function getPaymasterStubData(\n  service: PaymasterService,\n  userOp: UserOperation,\n  network: Network\n): Promise<PaymasterEstimationData> {\n  const provider = getRpcProvider([service.url], network.chainId)\n  return provider.send('pm_getPaymasterStubData', [\n    getCleanUserOp(userOp)[0],\n    ERC_4337_ENTRYPOINT,\n    toBeHex(network.chainId.toString()),\n    service.context\n  ])\n}\n\nexport async function getPaymasterData(\n  service: PaymasterService,\n  userOp: UserOperation,\n  network: Network\n): Promise<PaymasterData> {\n  const provider = getRpcProvider([service.url], network.chainId)\n  return provider.send('pm_getPaymasterData', [\n    getCleanUserOp(userOp)[0],\n    ERC_4337_ENTRYPOINT,\n    toBeHex(network.chainId.toString()),\n    service.context\n  ])\n}\n"]}