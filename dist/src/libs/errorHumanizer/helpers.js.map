{"version":3,"file":"helpers.js","sourceRoot":"","sources":["../../../../src/libs/errorHumanizer/helpers.ts"],"names":[],"mappings":"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","sourcesContent":["import { getErrorCodeStringFromReason, isReasonValid } from '../errorDecoder/helpers'\nimport { DecodedError, ErrorType } from '../errorDecoder/types'\nimport { ErrorHumanizerError } from './types'\n\nfunction getGenericMessageFromType(\n  errorType: ErrorType,\n  reason: DecodedError['reason'],\n  messagePrefix: string,\n  lastResortMessage: string,\n  withReason = true\n): string {\n  const messageSuffixNoSupport = withReason ? getErrorCodeStringFromReason(reason ?? '') : ''\n  const messageSuffix = `${messageSuffixNoSupport}\\nPlease try again or contact Ambire support for assistance.`\n  const origin = errorType?.split('Error')?.[0] || ''\n\n  switch (errorType) {\n    case ErrorType.RelayerError:\n    case ErrorType.RpcError:\n      return `${messagePrefix} of an unknown error (Origin: ${origin} call).${messageSuffix}`\n    case ErrorType.PaymasterError:\n      return `${messagePrefix} of a Paymaster Error.${messageSuffix}`\n    case ErrorType.BundlerError:\n      return `${messagePrefix} it's invalid.${messageSuffixNoSupport}`\n    case ErrorType.CodeError:\n    case ErrorType.UnknownError:\n      return `${messagePrefix} of an unknown error.${messageSuffix}`\n    case ErrorType.InnerCallFailureError:\n      return isReasonValid(reason)\n        ? `${messagePrefix} it will revert onchain.${messageSuffixNoSupport}`\n        : `${messagePrefix} it will revert onchain with reason unknown.${messageSuffix}`\n    // I don't think we should say anything else for this case\n    case ErrorType.UserRejectionError:\n      return 'Transaction rejected.'\n    // Panic error may scare the user so let's call it a contract error\n    case ErrorType.CustomError:\n    case ErrorType.PanicError:\n    case ErrorType.RevertError:\n      return `${messagePrefix} of a contract error.${messageSuffixNoSupport}`\n    default:\n      return lastResortMessage\n  }\n}\n\nconst getHumanReadableErrorMessage = (\n  commonError: string | null,\n  errors: ErrorHumanizerError[],\n  messagePrefix: string,\n  reason: DecodedError['reason'],\n  e: any\n) => {\n  if (commonError) return commonError\n\n  const checkAgainst = reason || e?.error?.message || e?.message\n  let message = null\n\n  if (checkAgainst && typeof checkAgainst === 'string') {\n    errors.forEach((error) => {\n      const { isExactMatch } = error\n\n      const isMatching = error.reasons.some((errorReason) => {\n        const lowerCaseReason = errorReason.toLowerCase()\n        const lowerCaseCheckAgainst = checkAgainst.toLowerCase()\n\n        if (isExactMatch) {\n          // Try a simple equality check first\n          if (lowerCaseCheckAgainst === lowerCaseReason) return true\n\n          // Split checkAgainst by spaces and check if any of the parts\n          // match the lowerCaseReason\n          const splitCheckAgainst = checkAgainst.split(' ')\n\n          return splitCheckAgainst.some((part) => part.toLowerCase() === lowerCaseReason)\n        }\n\n        return lowerCaseCheckAgainst.includes(lowerCaseReason)\n      })\n      if (!isMatching) return\n\n      message = `${messagePrefix ? `${messagePrefix} ` : ''}${error.message}`\n    })\n  }\n\n  return message\n}\n\nexport { getGenericMessageFromType, getHumanReadableErrorMessage }\n"]}