{"version":3,"file":"errors.js","sourceRoot":"","sources":["../../../../src/libs/selectedAccount/errors.ts"],"names":[],"mappings":"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","sourcesContent":["import { Network } from '../../interfaces/network'\nimport { RPCProviders } from '../../interfaces/provider'\nimport { SelectedAccountPortfolioState } from '../../interfaces/selectedAccount'\nimport {\n  AccountState as DefiPositionsAccountState,\n  DeFiPositionsError,\n  NetworksWithPositions\n} from '../defiPositions/types'\nimport { getNetworksWithFailedRPC } from '../networks/networks'\nimport { AccountAssetsState } from '../portfolio/interfaces'\nimport { PORTFOLIO_LIB_ERROR_NAMES } from '../portfolio/portfolio'\n\nconst TEN_MINUTES = 10 * 60 * 1000\n\nexport type Action = {\n  label: 'Select'\n  actionName: 'select-rpc-url'\n  meta: { network: Network }\n}\n\nexport type SelectedAccountBalanceError = {\n  id:\n    | `custom-rpcs-down-${string}`\n    | 'rpcs-down'\n    | 'portfolio-critical'\n    | 'loading-too-long'\n    | 'defi-critical'\n    | 'defi-prices'\n    | `${string}-defi-positions-error`\n    | keyof typeof PORTFOLIO_LIB_ERROR_NAMES\n  networkNames: string[]\n  type: 'error' | 'warning'\n  title: string\n  text?: string\n  actions?: Action[]\n}\n\nexport const getNetworksWithFailedRPCErrors = ({\n  providers,\n  networks,\n  networksWithAssets\n}: {\n  providers: RPCProviders\n  networks: Network[]\n  networksWithAssets: AccountAssetsState\n}): SelectedAccountBalanceError[] => {\n  const errors: SelectedAccountBalanceError[] = []\n  const chainIds = getNetworksWithFailedRPC({ providers }).filter(\n    (chainId) =>\n      (Object.keys(networksWithAssets).includes(chainId) && networksWithAssets[chainId] === true) ||\n      !Object.keys(networksWithAssets).includes(chainId)\n  )\n\n  const networksData = chainIds.map(\n    (id) => networks.find((n: Network) => n.chainId.toString() === id)!\n  )\n\n  const allFailed = networksData.length === networks.length\n\n  const networksWithMultipleRpcUrls = allFailed\n    ? []\n    : networksData.filter((n) => n?.rpcUrls?.length > 1)\n\n  const networksToGroupInSingleBanner = allFailed\n    ? networksData\n    : networksData.filter((n) => n?.rpcUrls?.length <= 1)\n\n  if (!networksData.length) return errors\n\n  networksWithMultipleRpcUrls.forEach((n) => {\n    errors.push({\n      id: `custom-rpcs-down-${n.chainId}`,\n      networkNames: [n.name],\n      type: 'error',\n      title: `Failed to retrieve network data for ${n.name}. You can try selecting another RPC URL`,\n      text: 'Affected features: visible assets, DeFi positions, sign message/transaction, ENS domain resolving, add account.',\n      actions: [\n        {\n          label: 'Select',\n          actionName: 'select-rpc-url',\n          meta: { network: n }\n        }\n      ]\n    })\n  })\n\n  if (!networksToGroupInSingleBanner.length) return errors\n\n  errors.push({\n    id: 'rpcs-down',\n    networkNames: networksToGroupInSingleBanner.map((n) => n.name),\n    type: 'error',\n    title: `Failed to retrieve network data for ${networksToGroupInSingleBanner\n      .map((n) => n.name)\n      .join(', ')} (RPC malfunction)`,\n    text: 'Affected features: visible assets, DeFi positions, sign message/transaction, ENS domain resolving, add account.'\n  })\n\n  return errors\n}\n\nconst addPortfolioError = (\n  errors: SelectedAccountBalanceError[],\n  networkName: string,\n  newError: keyof typeof PORTFOLIO_LIB_ERROR_NAMES | 'portfolio-critical' | 'loading-too-long'\n) => {\n  const newErrors = [...errors]\n  const existingError = newErrors.find((error) => error.id === newError)\n\n  if (existingError) {\n    existingError.networkNames.push(networkName)\n  } else {\n    let title = ''\n    let text = ''\n    let type: 'error' | 'warning' = 'error'\n\n    switch (newError) {\n      case 'portfolio-critical':\n        title = 'Failed to retrieve the portfolio data'\n        text = 'Account balance and visible assets may be inaccurate.'\n        break\n      case 'loading-too-long':\n        title = 'Loading is taking longer than expected'\n        text = 'Account balance and visible assets may be inaccurate.'\n        type = 'warning'\n        break\n      case PORTFOLIO_LIB_ERROR_NAMES.PriceFetchError:\n        title = 'Failed to retrieve prices'\n        text = 'Account balance and asset prices may be inaccurate.'\n        type = 'warning'\n        break\n      case PORTFOLIO_LIB_ERROR_NAMES.NoApiHintsError:\n        title = 'Automatic asset discovery is temporarily unavailable'\n        text =\n          'Your funds are safe, but your portfolio will be inaccurate. You can add assets manually or wait for the issue to be resolved.'\n        break\n      case PORTFOLIO_LIB_ERROR_NAMES.StaleApiHintsError:\n        title = 'Automatic asset discovery is temporarily unavailable'\n        text =\n          'New assets may not be visible in your portfolio. You can add assets manually or wait for the issue to be resolved.'\n        type = 'warning'\n        break\n      default:\n        break\n    }\n\n    if (!title) return newErrors\n\n    newErrors.push({\n      id: newError,\n      networkNames: [networkName],\n      type,\n      title,\n      text\n    })\n  }\n\n  return newErrors\n}\n\nexport const getNetworksWithPortfolioErrorErrors = ({\n  networks,\n  selectedAccountLatest,\n  providers,\n  isAllReady\n}: {\n  networks: Network[]\n  selectedAccountLatest: SelectedAccountPortfolioState\n  providers: RPCProviders\n  isAllReady: boolean\n}): SelectedAccountBalanceError[] => {\n  let errors: SelectedAccountBalanceError[] = []\n\n  if (!Object.keys(selectedAccountLatest).length) return []\n\n  Object.keys(selectedAccountLatest).forEach((chainId) => {\n    const portfolioForNetwork = selectedAccountLatest[chainId]\n    const criticalError = portfolioForNetwork?.criticalError\n    const lastSuccessfulUpdate = portfolioForNetwork?.result?.lastSuccessfulUpdate\n    let networkName = networks.find((n) => n.chainId.toString() === chainId)?.name\n\n    if (chainId === 'gasTank') networkName = 'Gas Tank'\n    else if (chainId === 'rewards') networkName = 'Rewards'\n\n    if (!networkName) {\n      console.error(\n        'Network name not found for network in getNetworksWithPortfolioErrorErrors',\n        chainId\n      )\n      return\n    }\n\n    if (portfolioForNetwork?.isLoading) {\n      // Add an error if the network is preventing the portfolio from going ready\n      // Otherwise skip the network\n      if (!isAllReady) errors = addPortfolioError(errors, networkName, 'loading-too-long')\n      return\n    }\n\n    // Don't display an error banner if the last successful update was less than 10 minutes ago\n    if (typeof lastSuccessfulUpdate === 'number' && Date.now() - lastSuccessfulUpdate < TEN_MINUTES)\n      return\n\n    if (!portfolioForNetwork || !chainId || portfolioForNetwork.isLoading) return\n    // Don't display an error banner if the RPC isn't working because an RPC error banner is already displayed.\n    // In case of additional networks don't check the RPC as there isn't one\n    if (\n      criticalError &&\n      (['gasTank', 'rewards'].includes(chainId) || providers[chainId]?.isWorking)\n    ) {\n      errors = addPortfolioError(errors, networkName, 'portfolio-critical')\n      return\n    }\n\n    portfolioForNetwork?.errors.forEach((err: any) => {\n      errors = addPortfolioError(errors, networkName as string, err.name)\n    })\n  })\n\n  return errors.map(({ title, networkNames, ...rest }) => {\n    const networkNamesString = networkNames.reduce((acc, name, index) => {\n      const isLast = index === networkNames.length - 1\n      const isOnly = networkNames.length === 1\n\n      return `${acc}${name}${isLast || isOnly ? '' : ', '}`\n    }, '')\n\n    return {\n      ...rest,\n      title: `${title} on ${networkNamesString}`,\n      networkNames\n    }\n  })\n}\n\nexport const getNetworksWithDeFiPositionsErrorErrors = ({\n  networks,\n  currentAccountState,\n  providers,\n  networksWithPositions\n}: {\n  networks: Network[]\n  currentAccountState: DefiPositionsAccountState\n  providers: RPCProviders\n  networksWithPositions: NetworksWithPositions\n}) => {\n  const isLoading = Object.keys(currentAccountState).some((chainId) => {\n    const networkState = currentAccountState[chainId]\n    return networkState.isLoading\n  })\n\n  if (isLoading) return []\n\n  const networkNamesWithUnknownCriticalError: string[] = []\n  const networkNamesWithAssetPriceCriticalError: string[] = []\n  const providersWithErrors: {\n    [providerName: string]: string[]\n  } = {}\n\n  Object.keys(currentAccountState).forEach((chainId) => {\n    const providersWithPositions = networksWithPositions[chainId]\n    // Ignore networks that don't have positions\n    // but ensure that we have a successful response stored (the network key is present)\n    if (providersWithPositions && !providersWithPositions.length) return\n\n    const networkState = currentAccountState[chainId]\n    const network = networks.find((n) => n.chainId.toString() === chainId)\n    const rpcProvider = providers[chainId]\n    const lastSuccessfulUpdate = networkState.updatedAt\n\n    if (\n      !network ||\n      !networkState ||\n      (typeof lastSuccessfulUpdate === 'number' &&\n        Date.now() - lastSuccessfulUpdate < TEN_MINUTES) ||\n      // Don't display an error banner if the RPC isn't working because an RPC error banner is already displayed.\n      (typeof rpcProvider.isWorking === 'boolean' && !rpcProvider.isWorking)\n    )\n      return\n\n    if (networkState.error) {\n      if (networkState.error === DeFiPositionsError.AssetPriceError) {\n        networkNamesWithAssetPriceCriticalError.push(network.name)\n      } else if (networkState.error === DeFiPositionsError.CriticalError) {\n        networkNamesWithUnknownCriticalError.push(network.name)\n      }\n    }\n\n    const providerNamesWithErrors =\n      networkState.providerErrors\n        ?.filter(({ providerName }) => {\n          // Display all errors if there hasn't been a successful update\n          // for the network.\n          if (!networksWithPositions[chainId]) return true\n          // Exclude providers without positions\n          return networksWithPositions[chainId].includes(providerName)\n        })\n        .map((e) => e.providerName) || []\n\n    if (providerNamesWithErrors.length) {\n      providerNamesWithErrors.forEach((providerName) => {\n        if (!providersWithErrors[providerName]) providersWithErrors[providerName] = []\n\n        providersWithErrors[providerName].push(network.name)\n      })\n    }\n  })\n\n  const providerErrors: SelectedAccountBalanceError[] = Object.entries(providersWithErrors).map(\n    ([providerName, networkNames]) => {\n      return {\n        id: `${providerName}-defi-positions-error`,\n        type: 'error',\n        networkNames,\n        title: `Failed to retrieve DeFi positions for ${providerName} on ${networkNames.join(', ')}`\n      }\n    }\n  )\n\n  const errors = providerErrors\n\n  if (networkNamesWithUnknownCriticalError.length) {\n    errors.push({\n      id: 'defi-critical',\n      type: 'error',\n      title: `Failed to retrieve DeFi positions on ${networkNamesWithUnknownCriticalError.join(\n        ', '\n      )}`,\n      networkNames: networkNamesWithUnknownCriticalError\n    })\n  }\n  if (networkNamesWithAssetPriceCriticalError.length) {\n    errors.push({\n      id: 'defi-prices',\n      type: 'warning',\n      title: `Failed to retrieve asset prices for DeFi positions on ${networkNamesWithAssetPriceCriticalError.join(\n        ', '\n      )}`,\n      networkNames: networkNamesWithAssetPriceCriticalError\n    })\n  }\n\n  return errors\n}\n"]}