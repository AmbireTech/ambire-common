{"version":3,"file":"assetInfo.js","sourceRoot":"","sources":["../../../../src/services/assetInfo/assetInfo.ts"],"names":[],"mappings":"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","sourcesContent":["import { Network } from '../../interfaces/network'\nimport { GetOptions, Portfolio, TokenResult } from '../../libs/portfolio'\nimport { getRpcProvider } from '../provider'\n\nconst RANDOM_ADDRESS = '0x0000000000000000000000000000000000000001'\nconst scheduledActions: {\n  [chainId: string]:\n    | {\n        promise: Promise<any>\n        data: { callback: Function; address: string }[]\n      }\n    | undefined\n} = {}\n\nexport async function executeBatchedFetch(network: Network): Promise<void> {\n  const rpcUrl = network.selectedRpcUrl || network.rpcUrls[0]\n  const provider = getRpcProvider([rpcUrl], network.chainId)\n  const allAddresses =\n    Array.from(new Set(scheduledActions[network.chainId.toString()]?.data.map((i) => i.address))) ||\n    []\n  const portfolio = new Portfolio(fetch as any, provider, network)\n  const options: Partial<GetOptions> = {\n    disableAutoDiscovery: true,\n    additionalErc20Hints: allAddresses,\n    additionalErc721Hints: Object.fromEntries(\n      allAddresses.map((i) => [\n        i,\n        {\n          tokens: ['1'],\n          isKnown: false\n        }\n      ])\n    )\n  }\n  const portfolioResponse = await portfolio.get(RANDOM_ADDRESS, options)\n\n  scheduledActions[network.chainId.toString()]?.data.forEach((i) => {\n    const tokenInfo =\n      (i.address,\n      portfolioResponse.tokens.find(\n        (t) => t.address.toLocaleLowerCase() === i.address.toLowerCase()\n      ))\n    const nftInfo =\n      (i.address,\n      portfolioResponse.collections.find(\n        (t) => t.address.toLocaleLowerCase() === i.address.toLowerCase()\n      ))\n\n    i.callback({ tokenInfo, nftInfo })\n  })\n}\n\n/**\n * Resolves symbol and decimals for tokens or name for nfts.\n */\nexport async function resolveAssetInfo(\n  address: string,\n  network: Network,\n  callback: (arg: { tokenInfo?: TokenResult; nftInfo?: { name: string } }) => void\n): Promise<void> {\n  if (!scheduledActions[network.chainId.toString()]?.data?.length) {\n    scheduledActions[network.chainId.toString()] = {\n      promise: new Promise((resolve, reject) => {\n        setTimeout(async () => {\n          await executeBatchedFetch(network).catch(reject)\n          scheduledActions[network.chainId.toString()] = undefined\n          resolve(0)\n        }, 500)\n      }),\n      data: [{ address, callback }]\n    }\n  } else {\n    scheduledActions[network.chainId.toString()]?.data.push({ address, callback })\n  }\n  // we are returning a promise so we can await the full execution\n  return scheduledActions[network.chainId.toString()]?.promise\n}\n"]}