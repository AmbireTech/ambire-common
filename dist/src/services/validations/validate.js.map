{"version":3,"file":"validate.js","sourceRoot":"","sources":["../../../../src/services/validations/validate.ts"],"names":[],"mappings":"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","sourcesContent":["import { getAddress, parseUnits } from 'ethers'\nimport isEmail from 'validator/es/lib/isEmail'\n\nimport { TokenResult } from '../../libs/portfolio'\nimport { getTokenAmount } from '../../libs/portfolio/helpers'\nimport { getSanitizedAmount } from '../../libs/transfer/amount'\nimport { isValidAddress } from '../address'\n\ntype ValidateReturnType = {\n  success: boolean\n  message: string\n}\n\nconst validateAddress = (address: string): ValidateReturnType => {\n  if (!(address && address.length)) {\n    return {\n      success: false,\n      message: ''\n    }\n  }\n\n  if (!(address && isValidAddress(address))) {\n    return {\n      success: false,\n      message: 'Invalid address.'\n    }\n  }\n\n  try {\n    getAddress(address)\n  } catch {\n    return {\n      success: false,\n      message: 'Invalid checksum. Verify the address and try again.'\n    }\n  }\n\n  return { success: true, message: '' }\n}\n\nconst validateAddAuthSignerAddress = (address: string, selectedAcc: any): ValidateReturnType => {\n  const isValidAddr = validateAddress(address)\n  if (!isValidAddr.success) return isValidAddr\n\n  if (address && selectedAcc && address === selectedAcc) {\n    return {\n      success: false,\n      message: 'The entered address should be different than your own account address.'\n    }\n  }\n\n  return { success: true, message: '' }\n}\n\nconst NOT_IN_ADDRESS_BOOK_MESSAGE =\n  \"This address isn't in your Address Book. Double-check the details before confirming.\"\nconst validateSendTransferAddress = (\n  address: string,\n  selectedAcc: string,\n  addressConfirmed: any,\n  isRecipientAddressUnknown: boolean,\n  isRecipientHumanizerKnownTokenOrSmartContract: boolean,\n  isEnsAddress: boolean,\n  isRecipientDomainResolving: boolean,\n  isSWWarningVisible?: boolean,\n  isSWWarningAgreed?: boolean\n): ValidateReturnType => {\n  // Basic validation is handled in the AddressInput component and we don't want to overwrite it.\n  if (!isValidAddress(address) || isRecipientDomainResolving) {\n    return {\n      success: true,\n      message: ''\n    }\n  }\n\n  if (selectedAcc && address.toLowerCase() === selectedAcc.toLowerCase()) {\n    return {\n      success: false,\n      message: 'The entered address should be different than the your own account address.'\n    }\n  }\n\n  if (isRecipientHumanizerKnownTokenOrSmartContract) {\n    return {\n      success: false,\n      message: 'You are trying to send tokens to a smart contract. Doing so would burn them.'\n    }\n  }\n\n  if (\n    isRecipientAddressUnknown &&\n    !addressConfirmed &&\n    !isEnsAddress &&\n    !isRecipientDomainResolving\n  ) {\n    return {\n      success: false,\n      message: NOT_IN_ADDRESS_BOOK_MESSAGE\n    }\n  }\n\n  if (\n    isRecipientAddressUnknown &&\n    !addressConfirmed &&\n    isEnsAddress &&\n    !isRecipientDomainResolving\n  ) {\n    return {\n      success: false,\n      message: NOT_IN_ADDRESS_BOOK_MESSAGE\n    }\n  }\n\n  if (isRecipientAddressUnknown && addressConfirmed && isSWWarningVisible && !isSWWarningAgreed) {\n    return {\n      success: false,\n      message: 'Please confirm that the recipient address is not an exchange.'\n    }\n  }\n\n  return { success: true, message: '' }\n}\n\nconst validateSendTransferAmount = (\n  amount: string,\n  maxAmount: number,\n  maxAmountInFiat: number,\n  selectedAsset: TokenResult\n): ValidateReturnType => {\n  const sanitizedAmount = getSanitizedAmount(amount, selectedAsset.decimals)\n\n  if (!(sanitizedAmount && sanitizedAmount.length)) {\n    return {\n      success: false,\n      message: ''\n    }\n  }\n\n  if (!(sanitizedAmount && Number(sanitizedAmount) > 0)) {\n    return {\n      success: false,\n      message: 'The amount must be greater than 0.'\n    }\n  }\n\n  try {\n    if (sanitizedAmount && selectedAsset && selectedAsset.decimals) {\n      if (Number(sanitizedAmount) < 1 / 10 ** selectedAsset.decimals)\n        return {\n          success: false,\n          message: 'Token amount too low.'\n        }\n\n      const currentAmount: bigint = parseUnits(sanitizedAmount, selectedAsset.decimals)\n\n      if (currentAmount > getTokenAmount(selectedAsset)) {\n        return {\n          success: false,\n          message: `The amount is greater than the asset's balance: ${Number(maxAmount) || 0} ${\n            selectedAsset?.symbol\n          }${maxAmountInFiat ? `/ ${Number(maxAmountInFiat)} USD.` : ''}`\n        }\n      }\n    }\n  } catch (e) {\n    console.error(e)\n\n    return {\n      success: false,\n      message: 'Invalid amount.'\n    }\n  }\n\n  return { success: true, message: '' }\n}\n\nconst isValidCode = (code: string) => code.length === 6\n\nconst isValidPassword = (password: string) => password.length >= 8\n\nfunction isValidURL(url: string) {\n  const urlRegex =\n    /^(?:https?|ftp):\\/\\/(?:\\w+:{0,1}\\w*@)?(?:\\S+)(?::\\d+)?(?:\\/|\\/(?:[\\w#!:.?+=&%@!\\-\\/]))?$/\n\n  return urlRegex.test(url)\n}\n\nexport {\n  isEmail,\n  validateAddAuthSignerAddress,\n  validateSendTransferAddress,\n  validateSendTransferAmount,\n  isValidCode,\n  isValidPassword,\n  isValidURL\n}\n"]}