{"version":3,"file":"signMessage.js","sourceRoot":"","sources":["../../../../src/controllers/signMessage/signMessage.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,OAAO,EAAE,WAAW,EAAE,WAAW,EAAE,MAAM,QAAQ,CAAA;AAE1D,OAAO,cAAc,MAAM,8BAA8B,CAAA;AAKzD,OAAO,EACL,kBAAkB,EAClB,qBAAqB,EACrB,aAAa,EACb,sBAAsB,EACvB,MAAM,oCAAoC,CAAA;AAC3C,OAAO,qBAAqB,MAAM,mCAAmC,CAAA;AAGrE,OAAO,YAA0B,MAAM,8BAA8B,CAAA;AAKrE,MAAM,sBAAsB,GAAG;IAC7B,IAAI,EAAE,SAAS;CACP,CAAA;AAEV,MAAM,OAAO,qBAAsB,SAAQ,YAAY;IACrD,SAAS,CAAoB;IAE7B,UAAU,CAAqB;IAE/B,SAAS,CAAoB;IAE7B,0BAA0B,CAA2B;IAErD,SAAS,CAAoB;IAE7B,sCAAsC;IACtC,sDAAsD;IACtD,wBAAwB;IACxB,OAAO,CAAK;IAEZ,aAAa,GAAY,KAAK,CAAA;IAE9B,QAAQ,GAAkD,sBAAsB,CAAA;IAEhF,IAAI,GAGO,IAAI,CAAA;IAEf,aAAa,GAAmB,IAAI,CAAA;IAEpC,cAAc,GAAuB,IAAI,CAAA;IAEzC,cAAc,GAAuB,IAAI,CAAA;IAEzC,aAAa,GAAyB,IAAI,CAAA;IAE1C,YACE,QAA4B,EAC5B,SAA8B,EAC9B,QAA4B,EAC5B,QAA4B,EAC5B,yBAAoD;QAEpD,KAAK,EAAE,CAAA;QAEP,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAA;QACzB,IAAI,CAAC,UAAU,GAAG,SAAS,CAAA;QAC3B,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAA;QACzB,IAAI,CAAC,0BAA0B,GAAG,yBAAyB,CAAA;QAC3D,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAA;IAC3B,CAAC;IAED,KAAK,CAAC,IAAI,CAAC,EACT,IAAI,EACJ,aAAa,EAId;QACC,mEAAmE;QACnE,qEAAqE;QACrE,4CAA4C;QAC5C,IAAI,IAAI,CAAC,aAAa;YAAE,IAAI,CAAC,KAAK,EAAE,CAAA;QAEpC,MAAM,IAAI,CAAC,SAAS,CAAC,kBAAkB,CAAA;QAEvC,IAAI,CAAC,SAAS,EAAE,cAAc,CAAC,CAAC,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;YACpE,IAAI,IAAI,EAAE;gBACR,IAAI,CAAC,IAAI,GAAG,IAAI,CAAA;aACjB;YACD,IAAI,CAAC,aAAa,GAAG,aAAa,CAAA;YAClC,IAAI,CAAC,aAAa,GAAG,IAAI,CAAA;YACzB,IAAI,CAAC,UAAU,EAAE,CAAA;SAClB;aAAM;YACL,IAAI,CAAC,SAAS,CAAC;gBACb,KAAK,EAAE,OAAO;gBACd,OAAO,EACL,4HAA4H;gBAC9H,KAAK,EAAE,IAAI,KAAK,CACd,OAAO,aAAa,CAAC,OAAO,CAAC,IAAI,4DAA4D,CAC9F;aACF,CAAC,CAAA;SACH;IACH,CAAC;IAED,KAAK;QACH,IAAI,CAAC,IAAI,CAAC,aAAa;YAAE,OAAM;QAE/B,IAAI,CAAC,aAAa,GAAG,KAAK,CAAA;QAC1B,IAAI,CAAC,IAAI,GAAG,IAAI,CAAA;QAChB,IAAI,CAAC,aAAa,GAAG,IAAI,CAAA;QACzB,IAAI,CAAC,aAAa,GAAG,IAAI,CAAA;QACzB,IAAI,CAAC,cAAc,GAAG,IAAI,CAAA;QAC1B,IAAI,CAAC,cAAc,GAAG,IAAI,CAAA;QAC1B,IAAI,CAAC,UAAU,EAAE,CAAA;IACnB,CAAC;IAED,aAAa,CAAC,cAA2B,EAAE,cAA2B;QACpE,IAAI,CAAC,cAAc,GAAG,cAAc,CAAA;QACpC,IAAI,CAAC,cAAc,GAAG,cAAc,CAAA;QACpC,IAAI,CAAC,UAAU,EAAE,CAAA;IACnB,CAAC;IAED,KAAK,CAAC,KAAK;QACT,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE;YACvB,OAAO,qBAAqB,CAAC,oBAAoB,EAAE,CAAA;SACpD;QAED,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE;YACvB,OAAO,qBAAqB,CAAC,oBAAoB,EAAE,CAAA;SACpD;QAED,IAAI,CAAC,IAAI,CAAC,cAAc,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE;YAChD,OAAO,qBAAqB,CAAC,uBAAuB,EAAE,CAAA;SACvD;QAED,IAAI;YACF,IAAI,CAAC,OAAO,GAAG,MAAM,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,cAAc,CAAC,CAAA;YACvF,IAAI,IAAI,CAAC,OAAO,CAAC,IAAI;gBAAE,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,0BAA0B,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,CAAA;YAE9F,MAAM,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAC1C,CAAC,GAAG,EAAE,EAAE,CAAC,GAAG,CAAC,IAAI,KAAK,IAAI,CAAC,aAAa,EAAE,WAAW,CACtD,CAAA;YACD,IAAI,CAAC,OAAO,EAAE;gBACZ,MAAM,IAAI,KAAK,CACb,oJAAoJ,CACrJ,CAAA;aACF;YACD,MAAM,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI;YAC1C,+DAA+D;YAC/D,mCAAmC;YACnC,CAAC,CAAU,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,IAAI,CAAC,aAAa,CAAC,SAAS,CACtD,CAAA;YACD,IAAI,CAAC,OAAO,EAAE;gBACZ,MAAM,IAAI,KAAK,CAAC,2DAA2D,CAAC,CAAA;aAC7E;YAED,MAAM,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,EAAE,CAAC,CAAA;YAC3E,IAAI,SAAS,CAAA;YACb,IAAI;gBACF,IAAI,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,IAAI,KAAK,SAAS,EAAE;oBACjD,MAAM,OAAO,GAAG,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,OAAO,CAAA;oBAClD,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,OAAO,GAAG,WAAW,CAAC,OAAO,CAAC;wBACvD,CAAC,CAAC,OAAO;wBACT,CAAC,CAAC,OAAO,CAAC,WAAW,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAA;oBAE5C,SAAS,GAAG,MAAM,qBAAqB,CACrC,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,OAAO,EAClC,OAAO,EACP,OAAO,EACP,YAAY,EACZ,IAAI,CAAC,OAAO,CACb,CAAA;iBACF;gBAED,IAAI,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,IAAI,KAAK,cAAc,EAAE;oBACtD,IAAI,OAAO,CAAC,QAAQ,IAAI,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,WAAW,KAAK,QAAQ,EAAE;wBAC3E,MAAM,IAAI,KAAK,CACb,qOAAqO,CACtO,CAAA;qBACF;oBAED,SAAS,GAAG,MAAM,kBAAkB,CAClC,IAAI,CAAC,aAAa,CAAC,OAAO,EAC1B,OAAO,EACP,YAAY,EACZ,IAAI,CAAC,OAAO,EACZ,OAAO,CACR,CAAA;iBACF;aACF;YAAC,OAAO,KAAU,EAAE;gBACnB,MAAM,IAAI,KAAK,CACb,KAAK,EAAE,OAAO;oBACZ,oHAAoH,CACvH,CAAA;aACF;YAED,IAAI,CAAC,SAAS,EAAE;gBACd,MAAM,IAAI,KAAK,CACb,6GAA6G,CAC9G,CAAA;aACF;YAED,qEAAqE;YACrE,cAAc;YACd,SAAS;gBACP,OAAO,CAAC,QAAQ,IAAI,CAAC,YAAY,CAAC,UAAU;oBAC1C,CAAC,CAAC,0CAA0C;wBAC1C,sBAAsB,CAAC,SAAS,EAAE,OAAO,CAAC,QAAS,CAAC;oBACtD,CAAC,CAAC,SAAS,CAAA;YAEf,MAAM,qBAAqB,GACzB,OAAO,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,OAAO,KAAK,QAAQ;gBACpD,CAAC,CAAC,qBAAqB,CAAC,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,OAAO,CAAC;gBAC3D,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,OAAO,CAAA;YAExC,MAAM,gBAAgB,GAAG,MAAM,aAAa,CAAC;gBAC3C,OAAO;gBACP,QAAQ,EAAE,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,OAAO,EAAE,EAAE,IAAI,UAAU,CAAC;gBAC9D,sDAAsD;gBACtD,wDAAwD;gBACxD,MAAM,EAAE,IAAI,CAAC,aAAa,EAAE,WAAW;gBACvC,SAAS;gBACT,uEAAuE;gBACvE,OAAO,EAAE,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,IAAI,KAAK,SAAS,CAAC,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,SAAS;gBAC1F,SAAS,EACP,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,IAAI,KAAK,cAAc;oBAChD,CAAC,CAAC;wBACE,MAAM,EAAE,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,MAAM;wBACzC,KAAK,EAAE,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,KAAK;wBACvC,OAAO,EAAE,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,OAAO;qBAC5C;oBACH,CAAC,CAAC,SAAS;aAChB,CAAC,CAAA;YAEF,IAAI,CAAC,gBAAgB,EAAE;gBACrB,MAAM,IAAI,KAAK,CACb,mKAAmK,CACpK,CAAA;aACF;YAED,IAAI,CAAC,aAAa,GAAG;gBACnB,YAAY,EAAE,IAAI,CAAC,aAAa,CAAC,YAAY;gBAC7C,WAAW,EAAE,IAAI,CAAC,aAAa,CAAC,WAAW;gBAC3C,SAAS,EAAE,IAAI,CAAC,aAAa,CAAC,SAAS;gBACvC,OAAO,EAAE,IAAI,CAAC,aAAa,CAAC,OAAO;gBACnC,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE;gBAC/B,SAAS;gBACT,IAAI,EAAE,IAAI,CAAC,IAAI;aAChB,CAAA;YAED,OAAO,IAAI,CAAC,aAAa,CAAA;SAC1B;QAAC,OAAO,CAAM,EAAE;YACf,MAAM,KAAK,GAAG,CAAC,YAAY,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,kCAAkC,CAAC,EAAE,CAAC,CAAA;YACvF,MAAM,OAAO,GACX,CAAC,EAAE,OAAO,IAAI,mEAAmE,CAAA;YAEnF,OAAO,OAAO,CAAC,MAAM,CAAC,IAAI,cAAc,CAAC,EAAE,KAAK,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC,CAAA;SAC9E;IACH,CAAC;IAED,KAAK,CAAC,IAAI;QACR,MAAM,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,KAAK,IAAI,EAAE,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,CAAA;IACzD,CAAC;IAED,iBAAiB,CAAC,OAAwB;QACxC,IAAI,IAAI,CAAC,aAAa,EAAE,WAAW,CAAC,WAAW,EAAE,KAAK,OAAO,CAAC,WAAW,EAAE,EAAE;YAC3E,IAAI,CAAC,KAAK,EAAE,CAAA;SACb;IACH,CAAC;IAED,MAAM,CAAC,oBAAoB;QACzB,MAAM,OAAO,GACX,sHAAsH,CAAA;QACxH,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,yCAAyC,CAAC,CAAA;QAElE,OAAO,OAAO,CAAC,MAAM,CAAC,IAAI,cAAc,CAAC,EAAE,KAAK,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC,CAAA;IAC/E,CAAC;IAED,MAAM,CAAC,oBAAoB;QACzB,MAAM,OAAO,GACX,sHAAsH,CAAA;QACxH,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,sCAAsC,CAAC,CAAA;QAE/D,OAAO,OAAO,CAAC,MAAM,CAAC,IAAI,cAAc,CAAC,EAAE,KAAK,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC,CAAA;IAC/E,CAAC;IAED,MAAM,CAAC,uBAAuB;QAC5B,MAAM,OAAO,GAAG,4CAA4C,CAAA;QAC5D,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,2CAA2C,CAAC,CAAA;QAEpE,OAAO,OAAO,CAAC,MAAM,CAAC,IAAI,cAAc,CAAC,EAAE,KAAK,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC,CAAA;IAC/E,CAAC;CACF","sourcesContent":["import { hexlify, isHexString, toUtf8Bytes } from 'ethers'\n\nimport EmittableError from '../../classes/EmittableError'\nimport { Account } from '../../interfaces/account'\nimport { ExternalSignerControllers, Key } from '../../interfaces/keystore'\nimport { Network } from '../../interfaces/network'\nimport { Message } from '../../interfaces/userRequest'\nimport {\n  getEIP712Signature,\n  getPlainTextSignature,\n  verifyMessage,\n  wrapCounterfactualSign\n} from '../../libs/signMessage/signMessage'\nimport hexStringToUint8Array from '../../utils/hexStringToUint8Array'\nimport { AccountsController } from '../accounts/accounts'\nimport { SignedMessage } from '../activity/activity'\nimport EventEmitter, { Statuses } from '../eventEmitter/eventEmitter'\nimport { KeystoreController } from '../keystore/keystore'\nimport { NetworksController } from '../networks/networks'\nimport { ProvidersController } from '../providers/providers'\n\nconst STATUS_WRAPPED_METHODS = {\n  sign: 'INITIAL'\n} as const\n\nexport class SignMessageController extends EventEmitter {\n  #keystore: KeystoreController\n\n  #providers: ProvidersController\n\n  #networks: NetworksController\n\n  #externalSignerControllers: ExternalSignerControllers\n\n  #accounts: AccountsController\n\n  // this is the signer from keystore.ts\n  // we don't have a correct return type at getSigner so\n  // I'm leaving it as any\n  #signer: any\n\n  isInitialized: boolean = false\n\n  statuses: Statuses<keyof typeof STATUS_WRAPPED_METHODS> = STATUS_WRAPPED_METHODS\n\n  dapp: {\n    name: string\n    icon: string\n  } | null = null\n\n  messageToSign: Message | null = null\n\n  signingKeyAddr: Key['addr'] | null = null\n\n  signingKeyType: Key['type'] | null = null\n\n  signedMessage: SignedMessage | null = null\n\n  constructor(\n    keystore: KeystoreController,\n    providers: ProvidersController,\n    networks: NetworksController,\n    accounts: AccountsController,\n    externalSignerControllers: ExternalSignerControllers\n  ) {\n    super()\n\n    this.#keystore = keystore\n    this.#providers = providers\n    this.#networks = networks\n    this.#externalSignerControllers = externalSignerControllers\n    this.#accounts = accounts\n  }\n\n  async init({\n    dapp,\n    messageToSign\n  }: {\n    dapp?: { name: string; icon: string }\n    messageToSign: Message\n  }) {\n    // In the unlikely case that the signMessage controller was already\n    // initialized, but not reset, force reset it to prevent misleadingly\n    // displaying the prev sign message request.\n    if (this.isInitialized) this.reset()\n\n    await this.#accounts.initialLoadPromise\n\n    if (['message', 'typedMessage'].includes(messageToSign.content.kind)) {\n      if (dapp) {\n        this.dapp = dapp\n      }\n      this.messageToSign = messageToSign\n      this.isInitialized = true\n      this.emitUpdate()\n    } else {\n      this.emitError({\n        level: 'major',\n        message:\n          'Ambire does not support this request format for signing messages. Please contact support if you believe could be a glitch.',\n        error: new Error(\n          `The ${messageToSign.content.kind} signing method is not supported by signMessageController.`\n        )\n      })\n    }\n  }\n\n  reset() {\n    if (!this.isInitialized) return\n\n    this.isInitialized = false\n    this.dapp = null\n    this.messageToSign = null\n    this.signedMessage = null\n    this.signingKeyAddr = null\n    this.signingKeyType = null\n    this.emitUpdate()\n  }\n\n  setSigningKey(signingKeyAddr: Key['addr'], signingKeyType: Key['type']) {\n    this.signingKeyAddr = signingKeyAddr\n    this.signingKeyType = signingKeyType\n    this.emitUpdate()\n  }\n\n  async #sign() {\n    if (!this.isInitialized) {\n      return SignMessageController.#throwNotInitialized()\n    }\n\n    if (!this.messageToSign) {\n      return SignMessageController.#throwMissingMessage()\n    }\n\n    if (!this.signingKeyAddr || !this.signingKeyType) {\n      return SignMessageController.#throwMissingSigningKey()\n    }\n\n    try {\n      this.#signer = await this.#keystore.getSigner(this.signingKeyAddr, this.signingKeyType)\n      if (this.#signer.init) this.#signer.init(this.#externalSignerControllers[this.signingKeyType])\n\n      const account = this.#accounts.accounts.find(\n        (acc) => acc.addr === this.messageToSign?.accountAddr\n      )\n      if (!account) {\n        throw new Error(\n          'Account details needed for the signing mechanism are not found. Please try again, re-import your account or contact support if nothing else helps.'\n        )\n      }\n      const network = this.#networks.networks.find(\n        // @ts-ignore this.messageToSign is not null and it has a check\n        // but typescript malfunctions here\n        (n: Network) => n.id === this.messageToSign.networkId\n      )\n      if (!network) {\n        throw new Error('Network not supported on Ambire. Please contract support.')\n      }\n\n      const accountState = this.#accounts.accountStates[account.addr][network.id]\n      let signature\n      try {\n        if (this.messageToSign.content.kind === 'message') {\n          const message = this.messageToSign.content.message\n          this.messageToSign.content.message = isHexString(message)\n            ? message\n            : hexlify(toUtf8Bytes(message.toString()))\n\n          signature = await getPlainTextSignature(\n            this.messageToSign.content.message,\n            network,\n            account,\n            accountState,\n            this.#signer\n          )\n        }\n\n        if (this.messageToSign.content.kind === 'typedMessage') {\n          if (account.creation && this.messageToSign.content.primaryType === 'Permit') {\n            throw new Error(\n              'It looks like that this app doesn\\'t detect Smart Account wallets, and requested incompatible approval type. Please, go back to the app and change the approval type to \"Transaction\", which is supported by Smart Account wallets.'\n            )\n          }\n\n          signature = await getEIP712Signature(\n            this.messageToSign.content,\n            account,\n            accountState,\n            this.#signer,\n            network\n          )\n        }\n      } catch (error: any) {\n        throw new Error(\n          error?.message ||\n            'Something went wrong while signing the message. Please try again later or contact support if the problem persists.'\n        )\n      }\n\n      if (!signature) {\n        throw new Error(\n          'Ambire was not able to retrieve the signature. Please try again or contact support if the problem persists.'\n        )\n      }\n\n      // if the account is not deployed, it should be wrapped with EIP-6492\n      // magic bytes\n      signature =\n        account.creation && !accountState.isDeployed\n          ? // https://eips.ethereum.org/EIPS/eip-6492\n            wrapCounterfactualSign(signature, account.creation!)\n          : signature\n\n      const personalMsgToValidate =\n        typeof this.messageToSign.content.message === 'string'\n          ? hexStringToUint8Array(this.messageToSign.content.message)\n          : this.messageToSign.content.message\n\n      const isValidSignature = await verifyMessage({\n        network,\n        provider: this.#providers.providers[network?.id || 'ethereum'],\n        // the signer is always the account even if the actual\n        // signature is from a key that has privs to the account\n        signer: this.messageToSign?.accountAddr,\n        signature,\n        // @ts-ignore TODO: Be aware of the type mismatch, could cause troubles\n        message: this.messageToSign.content.kind === 'message' ? personalMsgToValidate : undefined,\n        typedData:\n          this.messageToSign.content.kind === 'typedMessage'\n            ? {\n                domain: this.messageToSign.content.domain,\n                types: this.messageToSign.content.types,\n                message: this.messageToSign.content.message\n              }\n            : undefined\n      })\n\n      if (!isValidSignature) {\n        throw new Error(\n          'Ambire failed to validate the signature. Please make sure you are signing with the correct key or device. If the problem persists, please contact Ambire support.'\n        )\n      }\n\n      this.signedMessage = {\n        fromActionId: this.messageToSign.fromActionId,\n        accountAddr: this.messageToSign.accountAddr,\n        networkId: this.messageToSign.networkId,\n        content: this.messageToSign.content,\n        timestamp: new Date().getTime(),\n        signature,\n        dapp: this.dapp\n      }\n\n      return this.signedMessage\n    } catch (e: any) {\n      const error = e instanceof Error ? e : new Error(`Signing failed. Error details: ${e}`)\n      const message =\n        e?.message || 'Something went wrong while signing the message. Please try again.'\n\n      return Promise.reject(new EmittableError({ level: 'major', message, error }))\n    }\n  }\n\n  async sign() {\n    await this.withStatus('sign', async () => this.#sign())\n  }\n\n  removeAccountData(address: Account['addr']) {\n    if (this.messageToSign?.accountAddr.toLowerCase() === address.toLowerCase()) {\n      this.reset()\n    }\n  }\n\n  static #throwNotInitialized() {\n    const message =\n      'Looks like there is an error while processing your sign message. Please retry, or contact support if issue persists.'\n    const error = new Error('signMessage: controller not initialized')\n\n    return Promise.reject(new EmittableError({ level: 'major', message, error }))\n  }\n\n  static #throwMissingMessage() {\n    const message =\n      'Looks like there is an error while processing your sign message. Please retry, or contact support if issue persists.'\n    const error = new Error('signMessage: missing message to sign')\n\n    return Promise.reject(new EmittableError({ level: 'major', message, error }))\n  }\n\n  static #throwMissingSigningKey() {\n    const message = 'Please select a signing key and try again.'\n    const error = new Error('signMessage: missing selected signing key')\n\n    return Promise.reject(new EmittableError({ level: 'major', message, error }))\n  }\n}\n"]}