{"version":3,"file":"actions.js","sourceRoot":"","sources":["../../../../src/controllers/actions/actions.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/no-floating-promises */\n\nimport EmittableError from '../../classes/EmittableError'\nimport { Account } from '../../interfaces/account'\nimport {\n  AccountOpAction,\n  Action,\n  BenzinAction,\n  DappRequestAction,\n  SignMessageAction,\n  SwapAndBridgeAction,\n  SwitchAccountAction\n} from '../../interfaces/actions'\nimport { NotificationManager } from '../../interfaces/notification'\nimport { WindowManager, WindowProps } from '../../interfaces/window'\n// eslint-disable-next-line import/no-cycle\nimport { messageOnNewAction } from '../../libs/actions/actions'\nimport { getDappActionRequestsBanners } from '../../libs/banners/banners'\nimport EventEmitter from '../eventEmitter/eventEmitter'\n// Kind of inevitable, the AccountsController has SelectedAccountController, which has ActionsController\n// eslint-disable-next-line import/no-cycle\nimport { SelectedAccountController } from '../selectedAccount/selectedAccount'\n\n// TODO: Temporarily. Refactor imports across the codebase to ref /interfaces/actions instead.\nexport type {\n  AccountOpAction,\n  Action,\n  BenzinAction,\n  DappRequestAction,\n  SignMessageAction,\n  SwitchAccountAction,\n  SwapAndBridgeAction\n}\n\nexport type ActionPosition = 'first' | 'last'\n\nexport type ActionExecutionType = 'queue' | 'queue-but-open-action-window' | 'open-action-window'\n\nconst SWAP_AND_BRIDGE_WINDOW_SIZE = {\n  width: 640,\n  height: 640\n}\n/**\n * The ActionsController is responsible for storing the converted userRequests\n * from the MainController into actions. After adding an action an action-window will be opened with the first action form actionsQueue\n * For most userRequests, there is a corresponding action in the actionsQueue\n * containing the details of the userRequest needed for displaying it to the user.\n * However, some userRequests can be batched together, resulting in a single action created for multiple requests.\n *\n * After being opened, the action-window will remain visible to the user until all actions are resolved or rejected,\n * or until the user forcefully closes the window using the system close icon (X).\n * All pending/unresolved actions can be accessed later from the banners on the Dashboard screen.\n */\nexport class ActionsController extends EventEmitter {\n  #selectedAccount: SelectedAccountController\n\n  #windowManager: WindowManager\n\n  #notificationManager: NotificationManager\n\n  actionWindow: {\n    windowProps: WindowProps\n    openWindowPromise?: Promise<WindowProps>\n    focusWindowPromise?: Promise<WindowProps>\n    loaded: boolean\n    pendingMessage: {\n      message: string\n      options?: {\n        timeout?: number\n        type?: 'error' | 'success' | 'info' | 'warning'\n        sticky?: boolean\n      }\n    } | null\n  } = {\n    windowProps: null,\n    loaded: false,\n    pendingMessage: null\n  }\n\n  actionsQueue: Action[] = []\n\n  currentAction: Action | null = null\n\n  #onActionWindowClose: () => void\n\n  get visibleActionsQueue(): Action[] {\n    return this.actionsQueue.filter((a) => {\n      if (a.type === 'accountOp') {\n        return a.accountOp.accountAddr === this.#selectedAccount.account?.addr\n      }\n      if (a.type === 'signMessage') {\n        return a.userRequest.meta.accountAddr === this.#selectedAccount.account?.addr\n      }\n      if (a.type === 'benzin') {\n        return a.userRequest.meta.accountAddr === this.#selectedAccount.account?.addr\n      }\n      if (a.type === 'switchAccount') {\n        return a.userRequest.meta.switchToAccountAddr !== this.#selectedAccount.account?.addr\n      }\n      if (a.type === 'swapAndBridge') {\n        return a.userRequest.meta.accountAddr === this.#selectedAccount.account?.addr\n      }\n\n      return true\n    })\n  }\n\n  constructor({\n    selectedAccount,\n    windowManager,\n    notificationManager,\n    onActionWindowClose\n  }: {\n    selectedAccount: SelectedAccountController\n    windowManager: WindowManager\n    notificationManager: NotificationManager\n    onActionWindowClose: () => void\n  }) {\n    super()\n\n    this.#selectedAccount = selectedAccount\n    this.#windowManager = windowManager\n    this.#notificationManager = notificationManager\n    this.#onActionWindowClose = onActionWindowClose\n\n    this.#windowManager.event.on('windowRemoved', async (winId: number) => {\n      if (\n        winId === this.actionWindow.windowProps?.id ||\n        (!this.visibleActionsQueue.length && this.currentAction && this.actionWindow.windowProps)\n      ) {\n        this.actionWindow.windowProps = null\n        this.actionWindow.loaded = false\n        this.actionWindow.pendingMessage = null\n        this.currentAction = null\n\n        this.actionsQueue = this.actionsQueue.filter((a) => a.type === 'accountOp')\n        if (this.visibleActionsQueue.length) {\n          await this.#notificationManager.create({\n            title:\n              this.actionsQueue.length > 1\n                ? `${this.actionsQueue.length} transactions queued`\n                : 'Transaction queued',\n            message: 'Queued pending transactions are available on your Dashboard.'\n          })\n        }\n        this.#onActionWindowClose()\n        this.emitUpdate()\n      }\n    })\n\n    this.#windowManager.event.on('windowFocusChange', async (winId: number) => {\n      if (this.actionWindow.windowProps) {\n        if (this.actionWindow.windowProps.id === winId && !this.actionWindow.windowProps.focused) {\n          this.actionWindow.windowProps.focused = true\n          this.emitUpdate()\n        } else if (\n          this.actionWindow.windowProps.id !== winId &&\n          this.actionWindow.windowProps.focused\n        ) {\n          this.actionWindow.windowProps.focused = false\n          this.emitUpdate()\n        }\n      }\n    })\n  }\n\n  addOrUpdateAction(\n    newAction: Action,\n    position: ActionPosition = 'last',\n    executionType: ActionExecutionType = 'open-action-window'\n  ) {\n    // remove the benzin action if a new actions is added\n    this.actionsQueue = this.actionsQueue.filter((a) => {\n      if (a.type === 'benzin') return false\n\n      if (a.type === 'switchAccount') {\n        return a.userRequest.meta.switchToAccountAddr !== this.#selectedAccount.account?.addr\n      }\n\n      return true\n    })\n    if (this.currentAction && this.currentAction.type === 'benzin') {\n      this.currentAction = null\n    }\n\n    const actionIndex = this.actionsQueue.findIndex((a) => a.id === newAction.id)\n    if (actionIndex !== -1) {\n      this.actionsQueue[actionIndex] = newAction\n      if (executionType !== 'queue') {\n        let currentAction = null\n        if (executionType === 'open-action-window') {\n          this.sendNewActionMessage(newAction, 'updated')\n          currentAction = this.visibleActionsQueue.find((a) => a.id === newAction.id) || null\n        } else if (executionType === 'queue-but-open-action-window') {\n          this.sendNewActionMessage(newAction, 'queued')\n          currentAction = this.currentAction || this.visibleActionsQueue[0] || null\n        }\n        this.#setCurrentAction(currentAction)\n      } else {\n        this.emitUpdate()\n      }\n      return\n    }\n\n    if (position === 'first') {\n      this.actionsQueue.unshift(newAction)\n    } else {\n      this.actionsQueue.push(newAction)\n    }\n\n    if (executionType !== 'queue') {\n      let currentAction = null\n      if (executionType === 'open-action-window') {\n        currentAction = this.visibleActionsQueue.find((a) => a.id === newAction.id) || null\n      } else if (executionType === 'queue-but-open-action-window') {\n        this.sendNewActionMessage(newAction, 'queued')\n        currentAction = this.currentAction || this.visibleActionsQueue[0] || null\n      }\n      this.#setCurrentAction(currentAction)\n    } else {\n      this.emitUpdate()\n    }\n  }\n\n  removeAction(actionId: Action['id'], shouldOpenNextAction: boolean = true) {\n    this.actionsQueue = this.actionsQueue.filter((a) => a.id !== actionId)\n\n    if (!this.visibleActionsQueue.length) {\n      this.#setCurrentAction(null)\n    } else if (shouldOpenNextAction) {\n      this.#setCurrentAction(this.visibleActionsQueue[0])\n    }\n  }\n\n  #setCurrentAction(nextAction: Action | null) {\n    this.currentAction = nextAction\n    this.emitUpdate()\n\n    if (nextAction) {\n      this.openActionWindow()\n      return\n    }\n\n    if (!this.actionWindow.windowProps?.id) return\n\n    this.#windowManager.remove(this.actionWindow.windowProps.id)\n  }\n\n  setCurrentActionById(actionId: Action['id']) {\n    const action = this.visibleActionsQueue.find((a) => a.id.toString() === actionId.toString())\n    if (!action)\n      throw new EmittableError({\n        message:\n          'Failed to open request window. If the issue persists, please reject the request and try again.',\n        level: 'major',\n        error: new Error(`Action not found. Id: ${actionId}`)\n      })\n    this.#setCurrentAction(action)\n  }\n\n  setCurrentActionByIndex(actionIndex: number) {\n    const action = this.visibleActionsQueue[actionIndex]\n    if (!action)\n      throw new EmittableError({\n        message:\n          'Failed to open request window. If the issue persists, please reject the request and try again.',\n        level: 'major',\n        error: new Error(`Action not found. Index: ${actionIndex}`)\n      })\n    this.#setCurrentAction(action)\n  }\n\n  sendNewActionMessage(newAction: Action, type: 'queued' | 'updated') {\n    if (this.visibleActionsQueue.length > 1 && newAction.type !== 'benzin') {\n      if (this.actionWindow.loaded) {\n        const message = messageOnNewAction(newAction, type)\n        if (message) this.#windowManager.sendWindowToastMessage(message, { type: 'success' })\n      } else {\n        const message = messageOnNewAction(newAction, type)\n        if (message) this.actionWindow.pendingMessage = { message, options: { type: 'success' } }\n      }\n    }\n  }\n\n  async openActionWindow() {\n    await this.actionWindow.focusWindowPromise\n    await this.actionWindow.openWindowPromise\n    if (this.actionWindow.windowProps) {\n      this.focusActionWindow()\n    } else {\n      let customSize\n\n      if (this.currentAction?.type === 'swapAndBridge') {\n        customSize = SWAP_AND_BRIDGE_WINDOW_SIZE\n      }\n\n      try {\n        this.actionWindow.openWindowPromise = this.#windowManager\n          .open({\n            customSize\n          })\n          .finally(() => {\n            this.actionWindow.openWindowPromise = undefined\n          })\n        this.actionWindow.windowProps = await this.actionWindow.openWindowPromise\n        this.emitUpdate()\n      } catch (err) {\n        this.emitError({\n          message:\n            'Failed to open a new request window. Please restart your browser if the issue persists.',\n          level: 'major',\n          error: err as Error\n        })\n      }\n    }\n  }\n\n  async focusActionWindow() {\n    await this.actionWindow.focusWindowPromise\n    await this.actionWindow.openWindowPromise\n    if (!this.visibleActionsQueue.length || !this.currentAction || !this.actionWindow.windowProps)\n      return\n    try {\n      this.actionWindow.focusWindowPromise = this.#windowManager\n        .focus(this.actionWindow.windowProps)\n        .finally(() => {\n          this.actionWindow.focusWindowPromise = undefined\n        })\n\n      const newActionWindowProps = await this.actionWindow.focusWindowPromise\n\n      if (newActionWindowProps) {\n        this.actionWindow.windowProps = newActionWindowProps\n      }\n\n      this.emitUpdate()\n    } catch (err) {\n      this.emitError({\n        message:\n          'Failed to focus the request window. Please restart your browser if the issue persists.',\n        level: 'major',\n        error: err as Error\n      })\n    }\n  }\n\n  closeActionWindow() {\n    if (!this.actionWindow.windowProps) return\n    this.#windowManager.remove(this.actionWindow.windowProps.id)\n  }\n\n  setWindowLoaded() {\n    if (!this.actionWindow.windowProps) return\n    this.actionWindow.loaded = true\n\n    if (this.actionWindow.pendingMessage) {\n      this.#windowManager.sendWindowToastMessage(\n        this.actionWindow.pendingMessage.message,\n        this.actionWindow.pendingMessage.options\n      )\n      this.actionWindow.pendingMessage = null\n    }\n    this.emitUpdate()\n  }\n\n  removeAccountData(address: Account['addr']) {\n    this.actionsQueue = this.actionsQueue.filter((a) => {\n      if (a.type === 'accountOp') {\n        return a.accountOp.accountAddr !== address\n      }\n      if (a.type === 'signMessage') {\n        return a.userRequest.meta.accountAddr !== address\n      }\n      if (a.type === 'benzin') {\n        return a.userRequest.meta.accountAddr !== address\n      }\n      if (a.type === 'switchAccount') {\n        return a.userRequest.meta.switchToAccountAddr !== address\n      }\n      if (a.type === 'swapAndBridge') {\n        return a.userRequest.meta.accountAddr !== address\n      }\n\n      return true\n    })\n\n    this.emitUpdate()\n  }\n\n  get banners() {\n    return getDappActionRequestsBanners(this.visibleActionsQueue)\n  }\n\n  toJSON() {\n    return {\n      ...this,\n      ...super.toJSON(),\n      visibleActionsQueue: this.visibleActionsQueue,\n      banners: this.banners\n    }\n  }\n}\n"]}