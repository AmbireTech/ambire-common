import { ZeroAddress } from 'ethers'

import humanizerInfo from '../../../../consts/humanizer/humanizerInfo.json'
import { AccountOp } from '../../../accountOp/accountOp'
import { HumanizerMeta } from '../../interfaces'
import { compareHumanizerVisualizations } from '../../testHelpers'
import { getAction, getLabel, getToken } from '../../utils'
import KyberModule from '.'

const transactions = [
  // swap eth for shib
  {
    to: '0x6131b5fae19ea4f9d964eac0408e4408b66337b5',
    value: 40000000000000000000n,
    data: '0xe21fd0e90000000000000000000000000000000000000000000000000000000000000020000000000000000000000000f081470f5c6fbccf48cc4e5b82dd926409dcdd67000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000d000000000000000000000000000000000000000000000000000000000000000f000000000000000000000000000000000000000000000000000000000000000c40000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee00000000000000000000000095ad61b0a150d79219dcf64e1e6cc01f0b64c4ce000000000000000000000000d8da6bf26964af9d7eed9e03e53415d37aa960450000000000000000000000000000000000000000000000000000000066714aab0000000000000000000000000000000000000000000000000000000000000be00000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000004600000000000000000000000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000004063407a490000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000f081470f5c6fbccf48cc4e5b82dd926409dcdd670000000000000000000000006ca298d2983ab03aa1da7679389d955a4efee15c000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000dac17f958d2ee523a2206206994597c13d831ec70000000000000000000000000000000000000000000000006f05b59d3b200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000040ca6182da00000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000200000000000000000000000007a819fa46734a49d0112796f9377e024c350fb2600000000000000000000000000000000000000006671465698e410abbf4b9e8000000000000000000000000095ad61b0a150d79219dcf64e1e6cc01f0b64c4ce000000000000000000000000dac17f958d2ee523a2206206994597c13d831ec7000000000000000000000000807cf9a772d5a3f9cefbc1192e939d62f0d9bd380000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004e0bfb4e69e66380000000000000000000000000000000000000000000000000000000000000006688d6516000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000006688d6516000000000000000000000000f081470f5c6fbccf48cc4e5b82dd926409dcdd670000000000000000000000000000000000000000000000000000000000000041762d4ec8661e9181498a71b6c4cad3c6b314009e33ee4e9b3dd05864c15e13925731c32fabe4099078fe18d60a25601c5205ef235e99e85af6f086a9de165ffa1b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000040ca6182da00000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000200000000000000000000000007a819fa46734a49d0112796f9377e024c350fb2600000000000000000000000000000000000000006671465646745a2cd901f6a500000000000000000000000095ad61b0a150d79219dcf64e1e6cc01f0b64c4ce000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000807cf9a772d5a3f9cefbc1192e939d62f0d9bd38000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c2ec780f54204f730000000000000000000000000000000000000000000000000000001158e460913d000000000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000001158e460913d00000000000000000000000000000f081470f5c6fbccf48cc4e5b82dd926409dcdd6700000000000000000000000000000000000000000000000000000000000000418e4d107c9910dc90b7987434b1f198184b8cd8ced6d500a8afcaadfb8293c7341afa61a2ce6551bdcd92407869ff045ff89836cdfb28f560df5b5f79972283d41c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000004063407a490000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000f081470f5c6fbccf48cc4e5b82dd926409dcdd6700000000000000000000000011b815efb8f581194ae79006d24e0d814b7697f6000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000dac17f958d2ee523a2206206994597c13d831ec7000000000000000000000000000000000000000000000000a688906bd8b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000040ca6182da00000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000200000000000000000000000007a819fa46734a49d0112796f9377e024c350fb260000000000000000000000000000000000000000667146564a5ef9251983b12000000000000000000000000095ad61b0a150d79219dcf64e1e6cc01f0b64c4ce000000000000000000000000dac17f958d2ee523a2206206994597c13d831ec7000000000000000000000000807cf9a772d5a3f9cefbc1192e939d62f0d9bd3800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000074ea7c449a4633068000000000000000000000000000000000000000000000000000000000000099cde2dce0000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000099cde2dce000000000000000000000000f081470f5c6fbccf48cc4e5b82dd926409dcdd670000000000000000000000000000000000000000000000000000000000000041753a1b17f8c259ecc95e823d55e78bda8244dff586e73b4cbbe824b23e07e3865ac787754b3fe0df7a86703c7f0e60b9ec02f7f94cefda0ef0fc557d39744d321b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000198d35a23533c019c9d00000000185e2efa2584ce5f98000000000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee00000000000000000000000095ad61b0a150d79219dcf64e1e6cc01f0b64c4ce0000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000001c0000000000000000000000000d8da6bf26964af9d7eed9e03e53415d37aa960450000000000000000000000000000000000000000000000022b1c8c1227a000000000000000000000000000000000000000000000183efe1a2d02dcb398851eb8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001fa7b22536f75726365223a226b7962657273776170222c22416d6f756e74496e555344223a223133373730322e3739373731303235393635222c22416d6f756e744f7574555344223a223133373137392e3930353131383230393134222c22526566657272616c223a22222c22466c616773223a322c22496e74656772697479496e666f223a7b224b65794944223a2231222c225369676e6174757265223a22492f31574a6a4f38425149685242317a34445356414e6d764c5355394f6955444f7a503353555472634b6d614e776b4c4643442f455874534b6a33466e2f595a6e685679587a57476e664f466f784448445372436c732f524574774c744d714f6e7169696a3470594e5648596b454a2b2f43537a7a7642656f48646d4e534f4d4369503761346c7a4b644e6a2f355a76747a5a5462654261316f6d7749306e59553159786c4530564e71414762524f5931356a6f4f596a583133645a426e6d4c65633375316a774e4475654c6e397767537a476f6e7645425762347161655a314f73657434683473586e7567346b2f577832666a48714f6e73722f6b45736b51725371706a6a636150796f696b6b53345370476f6d343031375979505733374f7230557338676d6b4d346a7962617031696e5a4668494b5a6c57335a586539612b7178355730524d4e7556706e7849674f4f387639513d3d227d7d000000000000'
  },
  // swap simple usdc for eth
  {
    to: '0x6131b5fae19ea4f9d964eac0408e4408b66337b5',
    value: 0n,
    data: '0x8af033fb00000000000000000000000011ddd59c33c73c44733b4123a86ea5ce57f6e854000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000002800000000000000000000000000000000000000000000000000000000000000500000000000000000000000000af88d065e77c8cc2239327c5edb3a432268e5831000000000000000000000000912ce59144191c1204e64559fe8253a0e49e65480000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000006969174fd72466430a46e18234d0b530c9fd5f49000000000000000000000000000000000000000000000000000000000007a0c600000000000000000000000000000000000000000000000008bdd9c0062efe53000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000260000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000066716af600000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000db86e7fe4074e3c29d2fd0ed1d104c00e11a196b0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000007a0c60000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000780200000034000000db86e7fe4074e3c29d2fd0ed1d104c00e11a196b01000000000000000000000000000000000000001900002710000000320000000025000000a0d518c5f4828a6e6574625301f3a4562313822402000000000a000027100000003200af88d065e77c8cc2239327c5edb3a432268e58310000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000009365920d41000000000000000008c91897d2c1e20400000000000000000000000000000000000000000000000000000000000001f57b22536f75726365223a226b7962657273776170222c22416d6f756e74496e555344223a22302e3439393739313532313333222c22416d6f756e744f7574555344223a22302e35303134373731323831393035373734222c22526566657272616c223a22222c22466c616773223a312c22496e74656772697479496e666f223a7b224b65794944223a2231222c225369676e6174757265223a224b36444734476d336e774a545066766a6d774b773663303476643179727345776d417330786f5370424b7962314f356c4a514e534c6b6772374148556c2b646843354b4f6b4f30774966732b394e67394b3379643932655636616449707567305347467356334a72486c6c4b58674539654a6b594347366b6a41634e6938506e4d33596d4c754c486d414152447377464c514334556632614a614a597373543759567867427563784744714865756f314c353368486c39477246642f414c3134344e6e555538564e5a4e696b556e3748547076743670754b4e4b446e36693447497237494d2b4a552b7a71794377693669447155756f3773696e6945756f4b5534314a5a2b74444a34377a334454765a33554669694b6a4b5374556d46316273344d393135414b7a6c776f775449587074316375417a6c6577754a444264376749692f2f437779416a325a70754659555233624752673d3d227d7d0000000000000000000000'
  }
]
const accountOp: AccountOp = {
  accountAddr: '0x6969174FD72466430a46e18234D0b530c9FD5f49',
  chainId: 42161n,
  // this may not be defined, in case the user has not picked a key yet
  signingKeyAddr: null,
  signingKeyType: null,
  // this may not be set in case we haven't set it yet
  nonce: null,
  calls: [],
  gasLimit: null,
  signature: null,
  gasFeePayment: null,
  // This is used when we have an account recovery to finalize before executing the AccountOp,
  // And we set this to the recovery finalization AccountOp; could be used in other scenarios too in the future,
  // for example account migration (from v1 QuickAcc to v2)
  accountOpToExecuteBefore: null
  // This is fed into the humanizer to help visualize the accountOp
  // This can contain info like the value of specific share tokens at the time of signing,
  // or any other data that needs to otherwise be retrieved in an async manner and/or needs to be
  // "remembered" at the time of signing in order to visualize history properly
  // humanizerMeta: {}
}
describe('KyberSwap', () => {
  test('basic', () => {
    const expectedVisualization = [
      [
        getAction('Swap'),
        getToken(ZeroAddress, 40000000000000000000n),
        getLabel('for'),
        getToken('0x95ad61b0a150d79219dcf64e1e6cc01f0b64c4ce', 7503793600473780810135445176n)
      ],
      [
        getAction('Swap'),
        getToken('0xaf88d065e77c8cc2239327c5edb3a432268e5831', 499910n),
        getLabel('for'),
        getToken('0x912ce59144191c1204e64559fe8253a0e49e6548', 629898941662428755n)
      ]
    ]
    const irCalls = KyberModule(accountOp, transactions, humanizerInfo as HumanizerMeta)
    compareHumanizerVisualizations(irCalls, expectedVisualization)
  })
})
