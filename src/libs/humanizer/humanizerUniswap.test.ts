import { describe, test } from '@jest/globals'

import { AccountOp } from '../accountOp/accountOp'
import { callsToIr, initHumanizerMeta } from './humanizer'

import { uniswapHumanizer } from './modules/Uniswap'
import { Ir } from './interfaces'

const humanizerInfo = initHumanizerMeta(require('./humanizerInfo.json'))

const accountOp: AccountOp = {
  accountAddr: '0xB674F3fd5F43464dB0448a57529eAF37F04cceA5',
  networkId: '1',
  // this may not be defined, in case the user has not picked a key yet
  signingKeyAddr: null,
  // this may not be set in case we haven't set it yet
  nonce: null,
  calls: [],
  gasLimit: null,
  signature: null,
  gasFeePayment: null,
  // This is used when we have an account recovery to finalize before executing the AccountOp,
  // And we set this to the recovery finalization AccountOp; could be used in other scenarios too in the future,
  // for example account migration (from v1 QuickAcc to v2)
  accountOpToExecuteBefore: null,
  // This is fed into the humanizer to help visualize the accountOp
  // This can contain info like the value of specific share tokens at the time of signing,
  // or any other data that needs to otherwise be retrieved in an async manner and/or needs to be
  // "remembered" at the time of signing in order to visualize history properly
  humanizerMeta: {}
}
const transactions = {
  uniV3Multicalls: [
    // first part of this has recipient 0x000...000. idk why
    {
      to: '0xE592427A0AEce92De3Edee1F18E0157C05861564',
      value: 100000000n,
      data: '0xac9650d800000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000000000000000000000000000000000000000000144c04b8d59000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000610744c1000000000000000000000000000000000000000000000006a5f226c6bca6fa750000000000000000000000000000000000000000000000000039ac0e6684b18b0000000000000000000000000000000000000000000000000000000000000042f65b5c5104c4fafd4b709d9d60a185eae063276c002710a0b86991c6218b36c1d19d4a2e9eb0ce3606eb480001f4c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004449404b7c0000000000000000000000000000000000000000000000000039ac0e6684b18b00000000000000000000000060a293703cfb82b398c48668d55f510d339a3e1c00000000000000000000000000000000000000000000000000000000'
    },
    {
      to: '0xE592427A0AEce92De3Edee1F18E0157C05861564',
      value: 0n,
      data: '0xac9650d800000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000104414bf38900000000000000000000000026ab1c0e34422caa85f73ccebb8e5eafe2e6b03b000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000000000000000000000000000000000000000271000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000064db6b530000000000000000000000000000000000000000000016c0201616d1bf32170d00000000000000000000000000000000000000000000000005216fd8055da496000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004449404b7c00000000000000000000000000000000000000000000000005216fd8055da4960000000000000000000000008919dc5c37e5297aa58b4c4b7de442ecfe0a9a7000000000000000000000000000000000000000000000000000000000'
    },
    {
      to: '0xE592427A0AEce92De3Edee1F18E0157C05861564',
      value: 0n,
      data: '0xac9650d800000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000104414bf389000000000000000000000000225735d708eab6813616e1eeffdd79c7a10460a4000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000000000000000000000000000000000000000271000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000064db6adb00000000000000000000000000000000000000000000236fa84f4c7faa7723410000000000000000000000000000000000000000000000000876022c89d962f1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004449404b7c0000000000000000000000000000000000000000000000000876022c89d962f1000000000000000000000000a8bc3c6598d7812925863d2d58e8280d5000000100000000000000000000000000000000000000000000000000000000'
    },
    {
      to: '0xE592427A0AEce92De3Edee1F18E0157C05861564',
      value: 700000000000000000n,
      data: '0xac9650d80000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000104414bf389000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000e8a3bf796ca5a13283ec6b1c5b645b91d7cfef5d0000000000000000000000000000000000000000000000000000000000000bb800000000000000000000000037a4d0ff423e9d0c597836bb0a7fe4c3cdb6e5ff0000000000000000000000000000000000000000000000000000000064ddcfd400000000000000000000000000000000000000000000000009b6e64a8ec600000000000000000000000000000000000000000000000000b9fac2645641bb1d22000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'
    }
  ]
}

// @NOTE just for development purposes, won't fail on bugs
describe('module tests', () => {
  beforeEach(async () => {
    accountOp.humanizerMeta = { ...humanizerInfo }
    accountOp.calls = []
  })
  test('uniV3', () => {
    accountOp.calls = [...transactions.uniV3Multicalls]
    let ir: Ir = callsToIr(accountOp)
    ;[ir] = uniswapHumanizer(accountOp, ir)
    ir.calls.forEach((c) => console.log(c))
  })
})
